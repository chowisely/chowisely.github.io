---
layout:		post
title:    "[Operating Systems] Interrupt & System Call"
date:     2020-08-20 13:00:00 +0930
tags:     [os]
series:   Operating Systems
comments: true
---

OSμ μΈν„°λ½νΈ κ΄€λ¦¬μ— λ€ν•΄ μ•μ•„λ³΄μ.

---

### "OS is interrupt-driven."

### Interrupt
μΌλ°μ μΌλ΅ **μΈν„°λ½νΈ(interrupt)**λ” ν•λ“μ›¨μ–΄κ°€ μ–΄λ– ν• μ΄λ²¤νΈλ¥Ό CPUμ—κ² μ•λ¦¬κΈ° μ„ν•΄μ„ μ‚¬μ©ν•λ” λ°©λ²•μ΄λ‹¤. ν•μ§€λ§ μ‹¤ν–‰ μ¤‘μΈ ν”„λ΅μ„Έμ¤κ°€ CPU λ‚΄μ μΈν„°λ½νΈ λΌμΈμ„ μ„Έν…ν•μ—¬ μΈν„°λ½νΈλ¥Ό κ±ΈκΈ°λ„ ν•λ‹¤. μ „μλ¥Ό λΉ„λ™κΈ°μ‹ μΈν„°λ½νΈ(asynchronous interrupt), ν›„μλ¥Ό λ™κΈ°μ‹ μΈν„°λ½νΈ(synchronous interrupt)λΌκ³  λ¶€λ¥Έλ‹¤. **λΉ„λ™κΈ°μ‹ μΈν„°λ½νΈλ” ν•λ“μ›¨μ–΄**, **λ™κΈ°μ‹ μΈν„°λ½νΈλ” μ†ν”„νΈμ›¨μ–΄**μ— μν•΄ κ±Έλ¦°λ‹¤κ³  μƒκ°ν•λ©΄ νΈν•λ‹¤.

μΆ…λ¥|μ„¤λ…|μμ‹|
---|---|---|
ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ|μ…μ¶λ ¥μ¥μΉ, νƒ€μ΄λ° μ¥μΉ, μ „μ› λ“± μ™Έλ¶€μ μΈ μ”μΈμ— μν•΄ λ°μƒ. ISR μΆ…λ£ ν›„ λ€κΈ°.|ν‚¤λ³΄λ“, λ§μ°μ¤ μ…λ ¥
μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ(exception or trap)|μ†ν”„νΈμ›¨μ–΄κ°€ OS μ„λΉ„μ¤λ¥Ό μ”μ²­ν•κ±°λ‚ μ—λ¬λ¥Ό μΌμΌμΌ°μ„ λ• λ°μƒ. ISR μΆ…λ£ ν›„ λ‹¤μ‹ ν”„λ΅κ·Έλ¨μΌλ΅ λμ•„κ±°λ‚ ν”„λ΅κ·Έλ¨μ„ κ°•μ λ΅ μΆ…λ£.|νμΌ μ½κΈ°/μ“°κΈ°, 0μΌλ΅ λ‚λ„κΈ°, μ¤λ²„ν”λ΅μ°

**μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ**λ” μ„Έ κ°€μ§€λ΅ λ‚λ‰  μ μλ‹¤.

μΆ…λ¥|μ„¤λ…|μμ‹|
---|---|---|
Trap|μλ„μ μΌλ΅ μΌμΌν‚¨ μμ™Έ. ISR μΆ…λ£ ν›„ μ‹¤ν–‰ μ¬κ°ν•¨.|μ‹μ¤ν… μ½
Fault|λ³µκµ¬κ°€ κ°€λ¥ν•  μλ„ μλ” μμ™Έ. ISR μΆ…λ£ ν›„ μ‹¤ν–‰μ„ μ¬κ°ν•  κ°€λ¥μ„±λ„ μμ.|0μΌλ΅ λ‚λ„κΈ°, μλ»λ λ©”λ¨λ¦¬ μ ‘κ·Ό
Abort|λ³µκµ¬κ°€ λ¶κ°€λ¥ν• μμ™Έ. ISR μ‹¤ν–‰ μ‹ ν”„λ΅κ·Έλ¨ κ°•μ  μΆ…λ£.|ν•λ“μ›¨μ–΄ κ³ μ¥

---

### Interrupt Service Routine(ISR)
CPUμ— μΈν„°λ½νΈκ°€ κ±Έλ¦¬λ©΄ **μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(interrupt service routine)**μ— μ μ–΄κ¶μ„ λ„κ²¨μ¤€λ‹¤. ISRμ€ μΈν„°λ½νΈμ μΆ…λ¥λ³„λ΅ **μΈν„°λ½νΈ ν•Έλ“¤λ¬(interrupt handler)**μ μ£Όμ†κ°€ λ‹΄κΈ΄ ν…μ΄λΈ”μΈ **μΈν„°λ½νΈ λ²΅ν„°(interrupt vector)**λ¥Ό λ³΄κ³  μ–΄λ–¤ μΈν„°λ½νΈκ°€ λ°μƒν–λ”μ§€ κ²°μ •ν•λ‹¤. κ·Έλ¦¬κ³  ν•΄λ‹Ήν•λ” μΈν„°λ½νΈ ν•Έλ“¤λ¬μ μ£Όμ†λ΅ μ΄λ™ν•μ—¬ μμ™Έμ²λ¦¬λ¥Ό μ‹¤ν–‰ν•λ‹¤.

---

### Dual Mode
μΌλ° μ‚¬μ©μκ°€ μ»΄ν“¨ν„°μ— μΉλ…μ μΈ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•  μ μ—†λ„λ΅, μΌλ° μ‚¬μ©μλ΅λ¶€ν„° μ‹μ¤ν…μ„ λ³΄νΈν•κΈ° μ„ν•΄ ν•λ“μ›¨μ–΄μ μΌλ΅ **μ΄μ¤‘ λ¨λ“(dual mode)**λΌλ” κ²ƒμ„ μ§€μ›ν•λ‹¤. μ΄μ¤‘ λ¨λ“λ” **μ‚¬μ©μ λ¨λ“(user mode)**μ™€ **μ»¤λ„ λ¨λ“(kernel mode)**λ΅ λ‚λ‰λ‹¤. κ·Έλ¦¬κ³  mode bit(user mode=1, kernel mode=0)λ¥Ό ν†µν•΄ λ‘ λ¨λ“λ¥Ό κµ¬λ¶„ν•λ‹¤. μΌλ°μ μΌλ΅ μ‚¬μ©μ ν”„λ΅μ„Έμ¤λ” μ‚¬μ©μ λ¨λ“μ—μ„λ” μ‹¤ν–‰λμ§€λ§ μ–΄λ–¤ νΉμ •ν• λ…λ Ήλ“¤μ€ μ»¤λ„ λ¨λ“μ—μ„λ§ μ‹¤ν–‰λλ‹¤. μ΄ νΉμ •ν• λ…λ Ήμ–΄λ“¤μ„ **νΉκ¶ λ…λ Ή(privileged instruction)**μ΄λΌκ³  ν•λ”λ° μλ»λ μ ‘κ·ΌμΌλ΅λ¶€ν„° OSμ™€ μ‚¬μ©μλ¥Ό λ³΄νΈν•κΈ° μ„ν•΄ λ¨μ•„λ†“μ€ λ…λ Ήμ–΄λ“¤μ μ§‘ν•©μ„ λ§ν•λ‹¤. μ—¬κΈ°μ— ν¬ν•¨λ λ…λ Ήμ–΄λ“¤μ€ OSλ§μ΄ μ‹¤ν–‰ν•  μ μλ‹¤.

---

### System Call
λ§μ•½ CPUκ°€ μ‚¬μ©μ ν”„λ΅μ„Έμ¤μ— ν¬ν•¨λ νΉκ¶ λ…λ Ήμ„ μ‹¤ν–‰ν•κ³ μ ν•λ‹¤λ©΄, λ°λ“μ‹ μ‚¬μ©μ λ¨λ“μ—μ„ μ»¤λ„ λ¨λ“λ΅ μ „ν™ν•΄μ•Ό ν•λ‹¤. ν”„λ΅μ„Έμ¤κ°€ νΉκ¶ λ…λ Ήμ„ μ‹¤ν–‰ν•κΈ° μ„ν•΄ **μ»¤λ„ λ¨λ“λ΅μ μ „ν™μ„ μ”μ²­ν•λ” μΈν„°νμ΄μ¤**λ¥Ό **μ‹μ¤ν… μ½(system call)**μ΄λΌκ³  ν•λ‹¤. μ‹μ¤ν… μ½μ€ trapμ ν• μΆ…λ¥μ΄κΈ°λ„ ν•λ‹¤.

>π”_ν”„λ΅μ„Έμ¤ Aκ°€ λ””μ¤ν¬λ΅λ¶€ν„° νμΌμ„ μ½μ–΄μ¤λ” λ…λ Ήμ„ μ‹¤ν–‰ν•λ‹¤κ³  ν–μ„ λ• λ‚΄λ¶€μ μΌλ΅ μΌμ–΄λ‚λ” κ³Όμ •μ€ λ‹¤μκ³Ό κ°™λ‹¤._
1. ν”„λ΅μ„Έμ¤ Aκ°€ μ‹μ¤ν… μ½μ„ μ”μ²­ν•λ©΄μ„ CPU λ‚΄μ— μΈν„°λ½νΈ λΌμΈμ„ μ„Έν…ν•λ‹¤.
2. CPUλ” μ‹¤ν–‰ μ¤‘μ΄λ λ…λ Ήμ–΄λ¥Ό λ§μΉκ³  μΈν„°λ½νΈ λΌμΈμ„ ν†µν•΄ μΈν„°λ½νΈκ°€ κ±Έλ Έμμ„ μΈμ§€ν•λ‹¤.
3. mode bitλ¥Ό 0μΌλ΅ λ°”κΎΈκ³  OSμ—κ² μ μ–΄κ¶μ„ λ„κΈ΄λ‹¤.
4. ν„μ¬ μ‹¤ν–‰ μ¤‘μ΄λ ν”„λ΅μ„Έμ„μ μƒνƒ λ° μ •λ³΄λ¥Ό PCB(process control block)μ— μ €μ¥ν•λ‹¤. κ·Έλ¦¬κ³  PC(program counter)μ—λ” λ‹¤μμ— μ‹¤ν–‰ν•  λ…λ Ήμ–΄μ μ£Όμ†λ¥Ό μ €μ¥ν•λ‹¤.
5. μ‹μ¤ν… μ½ λ£¨ν‹΄μ— ν•΄λ‹Ήν•λ” κ³³μΌλ΅ μ ν”„ν•κ³ , μ‹μ¤ν… μ½ ν…μ΄λΈ”μ„ μ°Έμ΅°ν•μ—¬ νμΌ μ½κΈ°μ— ν•΄λ‹Ήν•λ” μ‹μ¤ν… μ½μ„ μ‹¤ν–‰ν•λ‹¤.
6. ν•΄λ‹Ή λ£¨ν‹΄μ„ λλ‚΄λ©΄, mode bitλ¥Ό 1λ΅ λ°”κΎΈκ³  PCBμ— μ €μ¥ν–λ μƒνƒλ“¤κ³Ό PCλ¥Ό λ³µμ›μ‹ν‚¨λ‹¤.
7. PCμ— μ €μ¥λ μ£Όμ†(=λ§μ§€λ§‰μΌλ΅ μ‹¤ν–‰ν–λ λ…λ Ήμ–΄μ λ‹¤μ)λ΅ μ ν”„ν•μ—¬ κ³„μ† μ‹¤ν–‰ν•λ‹¤.

I/O λ…λ Ήμ„ μ‹¤ν–‰ν•  λ• CPUμ μ μ–΄κ¶μ΄ μ–΄λ””λ΅ κ°€λƒμ— λ”°λΌ λ™κΈ°μ‹κ³Ό λΉ„λ™κΈ°μ‹ λ‘ κ°€μ§€λ΅ λ‚λ‰λ‹¤. **λ™κΈ°μ‹ I/O(synchronous I/O)**λ” I/O λ…λ Ή μ”μ²­μ΄ μ™„λ£λμ–΄μ•Όμ§€λ§ μ‚¬μ©μ ν”„λ΅κ·Έλ¨μ— μ μ–΄κ°€ λ„μ–΄κ°€λ” κ²ƒμ΄λ‹¤. **λΉ„λ™κΈ°μ‹ I/O(asynchronous I/O)**λ” I/O λ…λ Ήμ΄ λλ‚  λ•κΉμ§€ κΈ°λ‹¤λ¦¬μ§€ μ•κ³  μ‚¬μ©μ ν”„λ΅κ·Έλ¨μΌλ΅ μ μ–΄κ°€ λ„μ–΄κ°€κ³  I/Oκ°€ μ™„λ£λλ©΄ μΈν„°λ½νΈλ΅ μ•λ¦°λ‹¤.

λ”°λΌμ„ μ„μ κ³Όμ •μ€ λ™κΈ°μ‹ I/Oλ¥Ό κΈ°μ¤€μΌλ΅ μ„¤λ…ν• κ²ƒμ΄λ‹¤. λΉ„λ™κΈ°μ‹ I/Oμ—μ„λ” I/O λ…λ Ήμ„ μ”μ²­ν•λ” 5λ²μ§Έλ¶€ν„° μ΅°κΈ λ‹¤λ¥΄κ² μ‹¤ν–‰λλ‹¤. ν”„λ΅μ„Έμ¤ Aμ μ •λ³΄λ¥Ό PCBμ— μ €μ¥ν•΄λ‘μ—μΌλ―€λ΅ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤μ PCBλ¥Ό μ½μ–΄μ™€μ„ μ‹¤ν–‰ν•λ‹¤. κ·Έλ¦¬κ³  I/O λ…λ Ήμ„ λ§μΉλ©΄ λ””λ°”μ΄μ¤ μ»¨νΈλ΅¤λ¬(device controller)κ°€ CPUμ—κ² μΈν„°λ½νΈλ¥Ό κ±Έ κ²ƒμ΄λ‹¤. CPUκ°€ μΈν„°λ½νΈλ¥Ό μΈμ§€ν•λ‹¤λ©΄, μ‹¤ν–‰ μ¤‘μ΄λ ν”„λ΅μ„Έμ¤μ μ •λ³΄λ¥Ό λ‹¤μ‹ μ €μ¥ν•κ³   OSμ—κ² μ μ–΄κ¶μ„ μ¤€λ‹¤. κ·Έλ¦¬κ³  OSλ” λ””λ°”μ΄μ¤ μ»¨νΈλ΅¤λ¬λ΅λ¶€ν„° λ²„νΌμ— μ €μ¥λ λ°μ΄ν„°λ¥Ό λ°›μ•„μ¨λ‹¤. κ·Έλ¦¬κ³  I/Oλ¥Ό μ”μ²­ν–λ λ…λ Ήμ–΄μ λ©”λ¨λ¦¬ μμ—­μ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” κ³Όμ •μ„ κ±°μΉλ‹¤. ν”„λ΅μ„Έμ¤μ μƒνƒλ” waitμ—μ„ ready μƒνƒλ΅ λ°”λ€κ³  ready queueμ— λ“¤μ–΄κ°€ λ‹¤μ μ‹¤ν–‰ λ•κΉμ§€ κΈ°λ‹¤λ¦°λ‹¤.

---

### Direct Access Memory
λ§μ€ μ–‘μ λ°μ΄ν„°λ¥Ό μ΄λ™ν•΄μ•Ό ν•λ‹¤λ©΄ CPUμ—κ² μΈν„°λ½νΈλ¥Ό λ§μ΄ κ±Έκ² λλ―€λ΅ μ¤λ²„ν—¤λ“κ°€ λ°μƒν•κ² λλ‹¤. μ¤λ²„ν—¤λ“λ¥Ό μ¤„μ΄κΈ° μ„ν•΄ CPUμ κ°μ… μ—†μ΄ λ””λ°”μ΄μ¤ μ»¨νΈλ΅¤λ¬μ™€ λ©”λ¨λ¦¬ μ‚¬μ΄μ— λ°μ΄ν„°λ¥Ό μ΄λ™ν•λ„λ΅ ν•λ” κ²ƒμ„ **DMA(direct access memory)**λΌκ³  ν•λ‹¤.

μ΄ λ°©μ‹μ„ μ‚¬μ©ν•¨μΌλ΅μ¨ μ–»μ„ μ μλ” μ μ€ CPUκ°€ λ””λ°”μ΄μ¤μ™€ λ©”λ¨λ¦¬ μ‚¬μ΄λ¥Ό μ¤‘μ¬ν•  ν•„μ”κ°€ μ‚¬λΌμ§€κΈ° λ•λ¬Έμ— CPUλ” κ·Έλ™μ• λ‹¤λ¥Έ μΌλ“¤μ„ ν•  μ μλ‹¤λ” κ²ƒμ΄λ‹¤. λν• λ°”μ΄νΈ λ‹¨μ„κ°€ μ•„λ‹ λΈ”λ΅ λ‹¨μ„λ΅ μΈν„°λ½νΈλ¥Ό κ±ΈκΈ° λ•λ¬Έμ— μ¤λ²„ν—¤λ“λ¥Ό μ¤„μΌ μ μλ‹¤.
